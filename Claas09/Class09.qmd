---
title: "Class09"
author: "Samuel Fisher (A18131929)"
format: pdf
---

## Data Import

The data comes as a CSV file from 538

```{r}
candy_file <- "candy-data.csv"

candy = read.csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/candy-power-ranking/candy-data.csv", row.names=1)
head(candy)
```

> Q1.How many different candy types are in this dataset?

```{r}
nrow(candy)
```
There are 85 different candy types in this dataset

> Q2. How many fruity candy types are in the dataset?

```{r}
sum(candy$fruity == 1)
```

There are 38 fruity candy types in this dataset

> Q3. What is your favorite candy (other than Twix) in the dataset and what is it's winpercent value?

```{r}
candy["100 Grand", "winpercent"]
```
My favorite candy in the dataset is 100 Grand with a winpercent of 66.97173. 

> Q4. What is the winpercent value for Kit Kat?

```{r}
candy["Kit Kat", "winpercent"]
```

The winpercent for Kit Kat is 76.7686. 

> Q5. What is the win percent for Tootsie Roll Snack Bars?

```{r}
candy["Tootsie Roll Snack Bars", "winpercent"]
```

```{r}
library("skimr")
skim(candy)
```

> Q6. Is there any variable/column that looks to be on a different scale to the majority of the other columns in the dataset?

Yes, winpercent is on a different scale. Most of the columns are binary, but winpercent is a continuous percentage (20 - 85)

> Q7. What do you think a zero and one represent for the candy$chocolate column?

0 = does not contain chocolate, while 1 = does contain chocolate. 

> Q8. Plot a histogram of winpercent values using both base R an ggplot2.

```{r}
hist(candy$winpercent,
     main = "Histogram of Win Percent",
     xlab = "Win Percent",
     col = "lightblue",
     breaks = 15)

```

```{r}
library(ggplot2)

ggplot(candy, aes(x = winpercent)) +
  geom_histogram(bins = 15, fill = "lightgreen", color = "black") +
  labs(title = "Histogram of Win Percent",
       x = "Win Percent",
       y = "Count")

```

> Q9. Is the distribution of winpercent values symmetrical?

No — the distribution of winpercent values is not symmetrical; it is slightly skewed. 

> Q10.Is the center of the distribution above or below 50%?

The center of the distribution is over 50%. 

> Q11. On average is chocolate candy higher or lower ranked than fruit candy?

steps to solve this:
1. find all chocolate candy in the dataset
2. extract or find their winpercent values
3. calculate the mean of these values 

4. find all fruit candy
5. find their winpercent values
6. calculate their mean value

```{r}
choc.candy <- candy[candy$chocolate==1, ] 
choc.win <- choc.candy$winpercent
mean(choc.win)
```

The mean winpercent value for chocolate candy is 60.92153. 

```{r}
fruit.candy <- candy[candy$fruity==1, ] 
fruit.win <- fruit.candy$winpercent
mean(fruit.win)
```

The mean winpercent value for fruity candy is 44.11974. 

> Q12. Is this difference statistically significant?

```{r}
t.test(choc.win, fruit.win)
```

The p-value is less than 0.05, therefore we can reject the null hypothesis that there is no difference in means. Therefore, the difference in means between fruity candies and chocolate candies are statistically significant from each other. 

> Q13. What are the five least liked candy types in this set?

```{r}
least <- candy[order(candy$winpercent), ]
head(least, 5)
```
The 5 least liked candies are Nik L Nip, Boston Baked Beans, Chiclets, Super Bubble, and Jawbusters. 


> Q14. What are the top 5 all time favorite candy types out of this set?

```{r}
top <- candy[order(candy$winpercent, decreasing=TRUE), ]
head(top, 5)
```

The top 5 candies are Reese's Peanut Butter Cup, Reese's Miniatures, Twix, Kit Kat, and Snickers.

> Q15. Make a first barplot of candy ranking based on winpercent values.

```{r, fig.width=8, fig.height=16}
library(ggplot2)

ggplot(candy) +
  aes(winpercent, rownames(candy)) +
  geom_col()

```

> Q16. This is quite ugly, use the reorder() function to get the bars sorted by winpercent?

```{r, fig.width=8, fig.height=16}
ggplot(candy) +
  aes(winpercent, reorder(rownames(candy), winpercent)) +
  geom_col()
```


## Adding Useful Color 

```{r, fig.width=8, fig.height=16}
my_cols=rep("black", nrow(candy))
my_cols[as.logical(candy$chocolate)] = "brown"
my_cols[as.logical(candy$bar)] = "orange"
my_cols[as.logical(candy$fruity)] = "hotpink"
ggplot(candy) + 
  aes(winpercent, reorder(rownames(candy),winpercent)) +
  geom_col(fill=my_cols) 
```

> Q17. What is the worst ranked chocolate candy?

The worst ranked chocolate candy is Sixlets. 

> Q18. What is the best ranked fruity candy?

The best ranked fruity candy is Starburst. 

## Looking at Pricepoints

```{r, fig.width=9, fig.height=9}
library(ggrepel)
ggplot(candy) +
  aes(winpercent, pricepercent, label = rownames(candy)) +
  geom_point(col = my_cols) +
  geom_text_repel(col = my_cols, size = 3.3, max.overlaps = Inf)
```

> Q19. Which candy type is the highest ranked in terms of winpercent for the least money - i.e. offers the most bang for your buck?

The candy that has the most bang for your buck is Reese's Miniatures. This is because Reese's Miniatures have a very high winpercent, while still having a relatively low pricepoint. 

> Q20. What are the top 5 most expensive candy types in the dataset and of these which is the least popular?

```{r}
ord <- order(candy$pricepercent, decreasing = TRUE)
head( candy[ord,c(11,12)], n=5 )
```

The top 5 most expensive candies are Nik L Nip, Nestle Smarties, Ring Pop, Hershey's Krackel, and Hershey's Milk Chocolate. The least popular of these is Nik L Nip with a winpercent of just 22.44. 


## Exploring the Correlation Structure

```{r}
library(corrplot)
cij <- cor(candy)
corrplot(cij)
```

> Q22. Examining this plot what two variables are anti-correlated (i.e. have minus values)?

Chocolate and fruity are strongly anti-correlated. 

> Q23. Similarly, what two variables are most positively correlated?

Chocolate and bar appear to be the most strongly correlated. They have the strongest dark blue circle off the diagonal. 

## Principal Component Analysis

```{r}
pca <- prcomp(candy, scale=T)
summary(pca)
```
```{r}
plot(pca$x[,1:2])
```

Adding some color
```{r}
plot(pca$x[,1:2], col=my_cols, pch=16)
```

# Make a new data-frame with our PCA results and candy data
```{r}
my_data <- cbind(candy, pca$x[,1:3])
```

```{r}
p <- ggplot(my_data) +
  aes(x = PC1, y = PC2,
      size = winpercent/100,
      text = rownames(my_data),
      label = rownames(my_data)) +
  geom_point(col = my_cols)
p
```

```{r, fig.width=9, fig.height=9}
library(ggrepel)

p + geom_text_repel(size=3.3, col=my_cols, max.overlaps = 5)  + 
  theme(legend.position = "none") +
  labs(title="Halloween Candy PCA Space",
       subtitle="Colored by type: chocolate bar (dark brown), chocolate other (light brown), fruity (red), other (black)",
       caption="Data from 538")
```

The main results figure: the PCA score plot:

```{r, fig.width=9, fig.height=9}
ggplot(pca$x) +
  aes(PC1, PC2, label=rownames(pca$x))+
  geom_point(col=my_cols) +
  geom_text_repel(col = my_cols, size = 3.3, max.overlaps = Inf) 
  
```


> Plotly Graph

library(plotly)
ggplotly(p)

Unable to generate the plotly graph as it is unable to be generated as a pdf


The "loadings" plot for PC1

```{r}
ggplot(pca$rotation) +
  aes(x = PC1,
      y = reorder(rownames(pca$rotation), PC1)) +
  geom_col()

```

> Q24. Complete the code to generate the loadings plot above. What original variables are picked up strongly by PC1 in the positive direction? Do these make sense to you? Where did you see this relationship highlighted previously?

PC1 loads most positively on fruity, pluribus, and hard. This makes sense because PC1 is separating fruity, hard, bag type candies from chocolate bar candies, which load negatively. This is the same pattern in the correlation matrix, where chocolate and fruity were strongly anti-correlated and chocolate was positively associated with bar candies.


> Q25. Based on your exploratory analysis, correlation findings, and PCA results, what combination of characteristics appears to make a “winning” candy? How do these different analyses (visualization, correlation, PCA) support or complement each other in reaching this conclusion?

Winning candies are usually chocolate bar candies with peanut/almond or caramel rather than  fruity or hard candies. The rankings and visualizations showed higher winpercent for chocolate bars. The correlation matrix linked chocolate-bar features positively with winpercent, negatively with fruity, and the PCA separated chocolate-bar vs fruity-hard candies along PC1. 
















